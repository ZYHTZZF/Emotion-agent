# 心理状态辅助评估智能体（文本 + 表情）

> ⚠ 声明：本项目仅用于学习研究与情绪风险筛查练习，**不能作为任何形式的医学或临床诊断依据**。如果存在持续的痛苦体验、自伤/自杀念头或明显功能受损，请务必尽快寻求专业心理/精神科帮助。

---

## 1. 项目简介

本项目实现了一个基于 **聊天对话 + 摄像头表情采集** 的心理状态辅助评估原型系统，主要功能：

- 通过 **随机抽取的访谈问题** 与用户进行多轮对话；
- 使用 **中文 RoBERTa 情感模型** 分析文本中负向情绪强度；
- 使用 **FER 表情识别模型**，每隔数秒自动采样摄像头画面，识别面部情绪分布；
- 结合文本与表情，生成 **0–10 分的综合风险评分**，并给出低/中/高风险等级说明；
- 支持接入 **豆包（Ark）大模型**，生成更加自然、有共情感的对话回复；
- 基于本地 SQLite 数据库，为每个邮箱账号记录历史评估记录，可按账号查询。

当前实现基于 **Gradio** 搭建 Web 界面，适合作为课程项目 / 科研 Demo / 竞赛作品的原型系统。

---

## 2. 功能模块概览

### 2.1 登录与账号管理

- 使用邮箱 + 密码登录；
- 首次使用某个邮箱时自动注册账号；
- 密码会进行哈希存储（SQLite 本地数据库），不同账号的数据相互隔离；
- 登录后才能访问评估模块和历史记录。

### 2.2 文本 + 表情风险评估模块

入口：主页面中的「**文本 + 表情风险评估助手**」。

功能特点：

- 从内置 **题库** 中随机抽取固定数量（目前为 10 个）问题：
  - 涉及情绪、睡眠、兴趣、精力、价值感、焦虑、人际压力、生存/自伤想法、保护因素等维度；
  - 每次评估的题目与顺序均不同，减少套路化回答。
- 文本分析：
  - 使用 `IDEA-CCNL/Erlangshen-Roberta-110M-Sentiment` 模型（通过 `transformers` 加载），输出文本负向情绪概率；
  - 检测若干高风险关键词（如“想死”“自杀”等），对评分进行附加权重。
- 表情分析：
  - 使用 `fer` + `tensorflow` 从摄像头实时画面中自动采样表情；
  - 统计愤怒 / 厌恶 / 害怕 / 伤心等负向表情占比，作为风险评分的一部分。
- 综合评分：
  - 文本负向概率 + 高危关键词 + 表情负向比例 → 综合风险 0–10 分；
  - 分为低 / 中 / 高三档，给出对应的说明与建议（仅作筛查参考）。

### 2.3 历史记录与回溯

- 每次评估完成后，系统会将以下信息写入本地 SQLite：
  - 时间戳；
  - 综合风险得分；
  - 风险等级说明；
  - 文本负向概率；
  - 高关注词列表；
  - **本轮实际提问的随机题目列表**；
  - 用户对每个问题的原始回答。
- 在「历史记录」页面中：
  - 可以按登录邮箱查看该账号的所有记录列表；
  - 选中某条记录后，可查看当时的每一道问题及对应回答，便于用户自我反思与长期追踪。

---

## 3. 项目结构（核心文件）

建议的基础结构如下：

```text
项目根目录
├─ main.py              # 整体入口，负责登录页 / 主页面 / 历史记录页 / 页面切换
├─ risk_module.py       # 风险评估核心逻辑：题库、对话状态、RoBERTa、FER、豆包调用等
├─ storage.py           # 用户 & 评估记录的持久化（SQLite）
├─ requirements.txt     # Python 依赖列表
├─ README.md            # 本说明文档
└─ data/
   └─ risk_history.db   # SQLite 数据库（运行后自动创建）
